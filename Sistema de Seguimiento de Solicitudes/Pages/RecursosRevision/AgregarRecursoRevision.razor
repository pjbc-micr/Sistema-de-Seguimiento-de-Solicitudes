@page "/menu/recursos-revision/registro/agregar"

@using System.Net.Http.Json
@using SolicitudesShared.RecursosRevision

@inject NavigationManager Navigation
@inject HttpClient Http
@inject IJSRuntime JS

<h3 class="module-header">Agregar Recurso de Revisión</h3>
<p class="module-subtitle">Capture la información solicitada:</p>

<div class="table-responsive mt-4">
    <table class="table table-bordered" style="width: 100%; text-align:center;">
        <thead style="background-color:#0d6efd; color:white; font-weight:bold;">
            <tr>
                <th>Número de Recurso de Revisión</th>
                <th>Estatus</th>
                <th>Contenido de la Solicitud</th>
                <th>Nombre de la Persona Recurrente</th>
                <th>Sentido de la Contestación</th>
                <th>Fecha del Acuerdo</th>
                <th>Contenido del Acuerdo</th>
            </tr>
        </thead>

        <tbody style="background-color:#e7f1ff;">
            <tr>
                <td><input class="form-control" @bind="Modelo.NumeroRecurso" /></td>
                <td><input class="form-control" @bind="Modelo.Estatus" /></td>
                <td><input class="form-control" @bind="Modelo.ContenidoSolicitud" /></td>
                <td><input class="form-control" @bind="Modelo.NombreRecurrente" /></td>
                <td><input class="form-control" @bind="Modelo.SentidoContestacion" /></td>
                <td><input type="date" class="form-control" @bind="Modelo.FechaAcuerdo" /></td>
                <td><input class="form-control" @bind="Modelo.ContenidoAcuerdo" /></td>
            </tr>
        </tbody>
    </table>
</div>

<button class="btn btn-primary mt-3" @onclick="Guardar">Guardar</button>

@code {
    private RecursoRevisionDTO Modelo = new RecursoRevisionDTO();

    private async Task Guardar()
    {
        try
        {
            var respuesta = await Http.PostAsJsonAsync("api/RecursoRevision/Agregar", Modelo);

            if (respuesta.IsSuccessStatusCode)
            {
                await JS.InvokeVoidAsync("alert", "Recurso de revisión registrado correctamente.");
                Navigation.NavigateTo("/menu/recursos-revision");
            }
            else
            {
                var txt = await respuesta.Content.ReadAsStringAsync();
                await JS.InvokeVoidAsync("alert", $"Error al guardar: {respuesta.StatusCode} - {txt}");
            }
        }
        catch (Exception ex)
        {
            await JS.InvokeVoidAsync("alert", $"Error al guardar: {ex.Message}");
        }
    }
}
